本研究では,  配信に途中参加したユーザがダイジェスト視聴可能なP2Pライブストリーミングシステムを提案してきた. そのために2つの段階を考え, 1つ目の段階では, P2Pネットワーク内で特別なサーバに頼らない, 汎用的なダイジェスト生成方式を提案した. 2つ目の段階では, 1つ目の段階において生成されたダイジェストをP2Pネットワーク内で保持し, それを拡散させるためのトポロジ設計を提案した.

この章では, まず1段階目のダイジェスト生成方式に対する評価を行い, その次に2段階目のトポロジ設計に対する評価を行う.

ダイジェスト生成方式では, まず3つの提案方式それぞれの適切な閾値を決めるための評価を行う. その次に実際の動画コンテンツを対象に提案システムを適応し, ダイジェスト生成に最も適切な方式を決定する. トポロジ設計では, まず各役割の適切な割合を決めるための評価を行う. その次にその役割が適切な役目を果たしているかの評価を行う. さらに生成されたダイジェストが適切にP2Pネットワーク内で保持され, 視聴出来たかの評価を行う.

表\ref{tbl:env}に評価実験を行った環境を示す.

\begin{table}[h]
  \caption{実行環境}
  \label{tbl:env}
  \centering
      {\small
        \begin{tabular}{|l|l|l|} \hline
          環境名 & 規格 & バージョン \\ \hline \hline
          OS & Ubuntu & 12.04 64-bit  \\ \hline
          CPU & Intel Core i7 2.10~GHz & \\ \hline
          メモリ & 8~GB & \\ \hline
          シミュレータ & NS2 & 2.35 \\ \hline
          言語 & OTcl & 1.14 \\ \cline{2-3}
           & TK & 8.5.10 \\ \hline
          可視化ツール & nam & 1.15 \\ \hline
        \end{tabular}
      }
\end{table}

\section{ダイジェスト生成方式に対する評価}
\subsection{評価の準備}
ダイジェスト生成方式に対する評価を行う際の準備について述べる. 評価の1つ目は, 3つの提案方式の適切な閾値を決めることである. 2つ目は3つの提案方式のうち最も適切な方式を決定することである.

2つの評価に共通するものとして, 対象となる映像がある. まず時間の長さの異なる3つ映像に対して, 時間の10分の1となる1つ2分間の正解シーンを用意した. つまり, 例えば100分の映像を扱う際には5個の正解シーンが存在するということである.

\subsection{適切な閾値の決定}
3つの提案方式の適切な閾値を決定するための評価方法について述べる. まず, 提案システムがダイジェストであると選出したシーンの数が, 元々用意しておいた正解シーンよりも半分以上であるものを集計する. なお, 正解シーンの前後2分間をダイジェストと判断した場合を選出出来たと判断して集計する. 集計した後, 最も多く正解シーンを選出した閾値を適切な値とする. 例えば100分の映像ならば, 正解シーンが5つ存在する. そのうち提案システムが半分以上選出出来たらならばプラス1カウントする. これを3つの映像それぞれについて行い, 最も多く選出出来た（映像は3種類なので最大で3）閾値を適切な値とする.

\subsubsection{閾値に基づくダイジェスト生成方式の閾値}
「閾値に基づくダイジェスト生成方式」では式\ref{fig:sikiiti}において閾値は, 増加率（$Th_{inc}$）, 減少率（$Th_{dec}$）, 一定期間（$T$）であった. 図\ref{fig:digest1-1}は閾値に基づくダイジェスト生成方式の抽出例である. 時刻に付いている赤い丸が正解シーンであり, 縦に緑の線がシステムがダイジェストであると判断して選出した箇所である. 図を見ると2箇所正解していることがわかる.

表\ref{tbl:digest1-1}に増加率0.05の時の正解シーン選出の結果を, 表\ref{tbl:digest1-2}に増加率0.10の時の正解シーン選出の結果を示す. 実験の結果, 増加率が0.1, 減少率が0.03, 一定期間が3である時が一番正解数が多く, 適切な値であることがわかった.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/digest1-1.eps}
  \caption{閾値に基づくダイジェスト生成方式の抽出例}
  \label{fig:digest1-1}
\end{figure}

\begin{table}[h]
  \caption{増加率0.05の時の正解シーン選出の結果}
  \label{tbl:digest1-1}
  \centering
      {\small
        \begin{tabular}{|l|l||l|l|l|} \hline
           \multicolumn{5}{|c|}{増加率（$Th_{inc}$）0.05} \\ \hline
           & & \multicolumn{3}{c|}{減少率（$Th_{dec}$）} \\ \hline
           & & 0.03 & 0.05 & 0.10 \\ \hline \hline \cline{2-5}
           & 1 & 0 & 1 & 1 \\ \cline{2-5}
           & 2 & 0 & 0 & 2 \\ \cline{2-5}
           & 3 & 2 & 2 & 1 \\ \cline{2-5}
           一定期間（$T$）& 4 & 1 & 1 & 1 \\ \cline{2-5}
           & 5 & 2 & 2 & 1 \\ \cline{2-5}
           & 6 & 2 & 2 & 1 \\ \cline{2-5}
           & 7 & 1 & 1 & 1 \\ \cline{2-5}
           \hline
        \end{tabular}
      }
\end{table}

\newpage

\begin{table}[h]
  \caption{増加率0.10の時の正解シーン選出の結果}
  \label{tbl:digest1-2}
  \centering
      {\small
        \begin{tabular}{|l|l||l|l|l|} \hline
           \multicolumn{5}{|c|}{増加率（$Th_{inc}$）0.10} \\ \hline
           & & \multicolumn{3}{c|}{減少率（$Th_{dec}$）} \\ \hline
           & & 0.03 & 0.05 & 0.10 \\ \hline \hline \cline{2-5}
           & 1 & 1 & 1 & 0 \\ \cline{2-5}
           & 2 & 2 & 2 & 1 \\ \cline{2-5}
           & 3 & 3 & 2 & 1 \\ \cline{2-5}
           一定期間（$T$）& 4 & 2 & 2 & 1 \\ \cline{2-5}
           & 5 & 2 & 2 & 1 \\ \cline{2-5}
           & 6 & 2 & 2 & 1 \\ \cline{2-5}
           & 7 & 1 & 1 & 1 \\ \cline{2-5}
           \hline
        \end{tabular}
      }
\end{table}

\newpage

\subsubsection{前後比較に基づくダイジェスト生成方式の閾値}
「前後比較に基づくダイジェスト生成方式」では式\ref{fig:zengo}において閾値は, 増加率（$Th_{inc}$）, 減少率（$Th_{dec}$）, 一定期間（$T$）であった. 図\ref{fig:digest2-1}は前後比較に基づくダイジェスト生成方式の抽出例である. 時刻に付いている赤い丸が正解シーンであり, 縦に緑の線がシステムがダイジェストであると判断して選出した箇所である. 図を見ると2箇所正解していることがわかる.

表\ref{tbl:digest2-1}に増加率0.05の時の正解シーン選出の結果を, 表\ref{tbl:digest2-2}に増加率0.10の時の正解シーン選出の結果を示す. 実験の結果, 増加率が0.1, 減少率が0.03, 一定期間が4である時が一番正解数が多く, 適切な値であることがわかった.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/digest2-1.eps}
  \caption{前後比較に基づくダイジェスト生成方式の抽出例}
  \label{fig:digest2-1}
\end{figure}

\begin{table}[h]
  \caption{増加率0.05の時の正解シーン選出の結果}
  \label{tbl:digest2-1}
  \centering
      {\small
        \begin{tabular}{|l|l||l|l|l|} \hline
          \multicolumn{5}{|c|}{増加率（$Th_{inc}$）0.05} \\ \hline
          & & \multicolumn{3}{c|}{減少率（$Th_{dec}$）} \\ \hline
          & & 0.03 & 0.05 & 0.10 \\ \hline \hline \cline{2-5}
          & 1 & 0 & 0 & 0 \\ \cline{2-5}
          & 2 & 1 & 1 & 1 \\ \cline{2-5}
          & 3 & 0 & 1 & 0 \\ \cline{2-5}
          一定期間（$T$）& 4 & 0 & 0 & 1 \\ \cline{2-5}
          & 5 & 0 & 0 & 0 \\ \cline{2-5}
          & 6 & 0 & 0 & 0 \\ \cline{2-5}
          & 7 & 0 & 0 & 1 \\ \cline{2-5}
          \hline
        \end{tabular}
      }
\end{table}

\begin{table}[h]
  \caption{増加率0.10の時の正解シーン選出の結果}
  \label{tbl:digest2-2}
  \centering
      {\small
        \begin{tabular}{|l|l||l|l|l|} \hline
          \multicolumn{5}{|c|}{増加率（$Th_{inc}$）0.10} \\ \hline
          & & \multicolumn{3}{c|}{減少率（$Th_{dec}$）} \\ \hline
          & & 0.03 & 0.05 & 0.10 \\ \hline \hline \cline{2-5}
          & 1 & 0 & 0 & 0 \\ \cline{2-5}
          & 2 & 1 & 1 & 0 \\ \cline{2-5}
          & 3 & 1 & 1 & 0 \\ \cline{2-5}
          一定期間（$T$）& 4 & 2 & 1 & 0 \\ \cline{2-5}
          & 5 & 0 & 1 & 1 \\ \cline{2-5}
          & 6 & 0 & 0 & 0 \\ \cline{2-5}
          & 7 & 0 & 0 & 1 \\ \cline{2-5}
          \hline
        \end{tabular}
      }
\end{table}

\newpage

\subsubsection{最小二乗法に基づくダイジェスト生成方式}
「最小二乗法に基づくダイジェスト生成方式」では式\ref{fig:jijo}において閾値は, 角度（度）, データ数（個）であった. 図\ref{fig:digest3-1}は最小二乗法に基づくダイジェスト生成方式の抽出例である. 時刻に付いている赤い丸が正解シーンであり, 縦に緑の線がシステムがダイジェストであると判断して選出した箇所である. 図を見ると5箇所正解していることがわかる.

表\ref{tbl:digest3-1}に正解シーン選出の結果を示す. 実験の結果, 角度（度）55, データ数（個）3である時が一番正解数が多く, 適切な値であることがわかった.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/digest3-1.eps}
  \caption{最小二乗法に基づくダイジェスト生成方式の抽出例}
  \label{fig:digest3-1}
\end{figure}

\begin{table}[h]
  \caption{正解シーン選出の結果}
  \label{tbl:digest3-1}
  \centering
      {\small
        \begin{tabular}{|l|l||l|l|l|l|l|l|l|l|l|l|l|l|} \hline
          & & \multicolumn{12}{|c|}{角度（度）} \\ \hline
          & & 25 & 30 & 35 & 40 & 45 & 50 & 55 & 60 & 65 & 70 & 75 & 80 \\ \hline \hline
          & 2 & 0 & 0 & 0 & 2 & 3 & 3 & 2 & 1 & 1 & 0 & 0 & 0 \\ \cline{2-14}
          データ数（個） & 1 & 1 & 1 & 1 & 1 & 1 & 3 & 3 & 2 & 2 & 2 & 2 & 2 \\ \cline{2-14}
          & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 2 & 2 & 2 & 2 & 2 & 2 \\ \cline{2-14}
          & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 1 & 1 & 1 & 1 & 1 \\ \cline{2-14}
          \hline
        \end{tabular}
      }
\end{table}

\subsection{提案方式の評価}
今までの実験により, それぞれの提案方式の適切な閾値がわかった. 次に, その適切な閾値を適応したそれぞれの提案方式を比較し, P2Pライブストリーミングにおいてダイジェストを生成する際に最も適当なダイジェスト生成方式を決定する.

3つの動画に対して, それぞれの提案方式の適合率を計算することによって評価する. 適合率は式\ref{siki:tekigo}に従う. これは, 提案方式がダイジェストとして選出したもののうち, 元々用意しておいた正解シーンが含まれている確立を意味する. 適合率の値が高いほど, より適切なダイジェスト生成方式であると言える. 表\ref{tbl:tekigo}に実験の結果を示す. 実験の結果, 最小二乗法に基づくダイジェスト生成方式の適合率が最も高く, 平均で66\%を超えるという結果になった.

\begin{eqnarray}
  適合率 = \frac{正解シーン数}{方式による抽出シーン数}
  \label{siki:tekigo}
\end{eqnarray}

\begin{table}[h]
  \caption{適合率の結果}
  \label{tbl:tekigo}
  \centering
      {\small
        \begin{tabular}{|l|l|l|l|} \hline
          & \multicolumn{3}{|c|}{適合率} \\ \hline
          生成方式 & 閾値に基づく方式 & 前後比較に基づく方式 & 最小二乗法に基づく方式 \\ \hline
          動画1 & 12.5\% & 50.0\% & 62.5\% \\ \hline
          動画2 & 37.5\% & 50.0\% & 75.0\% \\ \hline
          動画3 & 50.0\% & 50.0\% & 62.5\% \\ \hline
        \end{tabular}
      }
\end{table}

\subsection{ダイジェスト生成方式に対する評価の考察}
ダイジェスト生成方式の実験では, まずそれぞれの提案方式の適切な閾値を決定した. 次にその閾値を適応した提案方式の適合率を計算することによって最も適切なダイジェスト生成方式を決定した.

適切な閾値の決定では, 「閾値に基づくダイジェスト生成方式」, 「前後比較に基づくダイジェスト生成方式」, 「最小二乗法に基づくダイジェスト生成方式」のそれぞれで閾値を決定した. それぞれについて考察していく. 次に適合率の結果についての考察を行う.

\subsubsection{閾値に基づくダイジェスト生成方式}
閾値は増加率0.1, 減少率0.03, 一定時間3という結果であった. 増加率は減少率よりも高い値であった. これは, 瞬間的に多くのユーザがコメントをして, その瞬間に対して反応したことを意味している. 瞬間的に多くの反応があったということは, とても注目度が高いことを意味しており, ダイジェストにすべき瞬間であったことがわかる. まだ, 一定時間は3という結果であり, 長くもなく短くもない値であった. これは, 短すぎると雑音となる部分まで余計に反応してしまうためであり, 逆に長すぎると瞬間的な変化に反応出来ないからであると考えられる.

\subsubsection{前後比較に基づくダイジェスト生成方式}
閾値は増加率0.1, 減少率0.03, 一定時間4という結果であった. この閾値は「閾値に基づくダイジェスト生成方式」の結果とほぼ同じであり, 基本的には同様の考え方が出来る. しかし, こちらの方式では増加率が0.05の場合だとほとんど正解シーンを選出出来なかったことがわかる. これは「前後比較に基づくダイジェスト生成方式」の方では特に増加率の値に敏感であり, 細かい値を設定することが望ましいことがわかった.

\subsubsection{最小二乗法に基づくダイジェスト生成方式}
閾値は角度（度）55, データ数（個）3という結果であった. 全体的に角度は急なほど正解シーンを多く選出していることがわかる. これは, より瞬間的な状態を検出していることがわかる. データ数は少ない方が多く正解シーンを選出していることがわかる. これは, データ数が多いほどグラフをなだらかにしてしまい, 瞬間的な状態を検出出来なかったからではないかと考えられる.

\subsubsection{適合率の結果について}
適合率は「最小二乗法に基づくダイジェスト生成方式」が最も適切であることがわかった. これは, その他の方式では雑音となる突発的な瞬間を誤検知してしまったのに対し, こちらの方式では最小二乗法を適応していることで, より自然な盛り上がり部分をダイジェストとして捉え, 検出出来ているからではないかと考えられる.

\section{トポロジ設計に対する評価}
トポロジ設計に対する評価を行う. 評価はシミュレーションで行った. シミュレーションではNS-2を用いた. 提案システムでは各ノードに役割を与えたトポロジを設計した. その各役割の適切な割合についての評価を行う. また, 役割が適切に機能しているかの評価を行う. さらに, P2Pネットワーク内に十分なダイジェストを保有できているかを評価する.

% ここから下少し適当

\subsection{前提条件}
※ここから少し適当

シミュレーションを行う上でいくつかの前提となる条件について述べる. 前提となる項目は「帯域幅分布」, 「コメント数分布」, 「ノード数とクラスタ」がある. それぞれについての前提条件を決定する.

全ノードには固有の帯域幅を割り当てる. 「帯域幅分布」は表\ref{tbl:band-dist}のように決定する.

\begin{table}[h]
  \caption{帯域幅分布}
  \label{tbl:band-dist}
  \centering
      {\small
        \begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|} \hline
          \shortstack{帯域幅 \\ (kbps)} & 256 & 320 & 384 & 448 & 512 & 640 & 768 & 1024 & 1500 & 3000 \\ \hline
          \shortstack{割合 \\ (\%)} & 10.0 & 14.3 & 8.6 & 12.5 & 2.2 & 1.4 & 6.6 & 28.1 & 1.4 & 14.9 \\ \hline
        \end{tabular}
      }
\end{table}

また全ノードには固有のコメント数を割り当てる. サンプルとして1つの動画に対して分析を行った結果を利用する\cite{comment}. 平均コメント数は4で標準偏差は6.8である. 分析の結果を図\ref{fig:comment-res}に示す.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/comment-res.eps}
  \caption{コメント数分析の結果}
  \label{fig:comment-res}
\end{figure}

固有のコメント数を割り当てた結果である, 「コメント数分布」は表\ref{tb:comment-dist}のように決定する.

\begin{table}[h]
  \caption{コメント数分布}
  \label{tbl:comment-dist}
  \centering
      {\small
        \begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|} \hline
          \shortstack{コメント数} & 2 & 5 & 7 & 10 & 12 & 15 & 17 & 20 & 22 & 25 \\ \hline
          \shortstack{割合 \\ (\%)} & 16 & 17 & 17 & 16 & 15 & 13 & 10 & 2 & 1 & 1 \\ \hline
        \end{tabular}
      }
\end{table}



全ノード数に応じたクラスタの数を予め設定する. 全ノード数とクラスタ数対応表である, 「ノード数とクラスタ」を表\ref{tbl:cluster-dist}のように決定する.

\begin{table}[h]
  \caption{ノード数とクラスタ数対応表}
  \label{tbl:cluster-dist}
  \centering
      {\small
        \begin{tabular}{|c|c|c|c|c|} \hline
          \shortstack{ノード数} & 200 & 400 & 600 & 800 \\ \hline
          \shortstack{クラスタ数} & 7 & 10 & 14 & 18  \\ \hline
        \end{tabular}
      }
\end{table}

その他の前提条件として, ノード間遅延を全てのノード間で100msに設定している. またパケットロス率は0\%として考慮しないこととする. また, 参加離脱を考慮した実験においては, 10秒に1回参加と離脱を行うこととする. 参加はランダムであり, 最初はダイジェスト未取得のノーマルノードとなる. ダイジェスト未取得のノーマルノードは24秒経つとダイジェスト取得済みのダイジェストノードとなる. また, シミュレーションにおいての参加離脱はノードにパケットが流れたかどうかで判断する.

ノード数が200の時の、役割を与えた場合と与えない場合のトポロジ図をそれぞれ図\ref{fig:topology-role}と図\ref{fig:topology-no-role}に示す.

\newpage

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/topology-role.eps}
  \caption{役割を与えた場合のトポロジ図}
  \label{fig:topology-role}
\end{figure}

\newpage

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/topology-no-role.eps}
  \caption{役割を与えない場合のトポロジ図}
  \label{fig:topology-no-role}
\end{figure}

\newpage

\subsection{適切な役割の割合の決定}
提案するトポロジにはいくつか役割が存在する.このうち「ゲートノード」, 「セミゲートノード」, 「ダイジェストノード」の役割の適切な割合を決定する. まず最初に「ダイジェストノード」の割合を, 次に「ゲートノード」と「セミゲートノード」の割合を決定する.

\subsubsection{ダイジェストノードの割合}
ダイジェストノードの割合をそれぞれ, 全ノードの10\%, 20\%, 30\%で割合を変え, スループットの値を比較した. 図\ref{fig:digest-rate}に結果を示す.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/digest-rate.eps}
  \caption{ダイジェストノードの割合を変化させた時の結果}
  \label{fig:digest-rate}
\end{figure}

実験の結果, 10\%の時の平均スループットが265.71kbps, 20\%の時の平均スループットが573.12kbps, 30\%の時の平均スループットが414.63\%であった. 20\%の時が最もスループットの値が大きく, 適切な値であることがわかった.

\subsubsection{ゲートノードとセミゲートノードの割合}
次にゲートノードとセミゲートノードの割合を決定する. ゲートノードとセミゲートノードは常に1対2の関係となるため, 一緒に決定する. 全ノードのそれぞれ10\%と20\%, 20\%と40\%で割合を変え, スループットの値を比較した. 図\ref{fig:gate-semi-rate}に結果を示す.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/gate-semi-rate.eps}
  \caption{ゲートノードとセミゲートノードの割合を変化させた時の結果}
  \label{fig:gate-semi-rate}
\end{figure}

実験の結果, 10\%と20\%の時の平均スループットが446.33kbps, 20\%と40\%の時の平均スループットが413.48kbpsであった. どちらもそれほど変わらないが, 10\%と20\%の方がスループットの値が大きかった. しかし, グラフを見るとノード数が小さい時は10\%と20\%の時の方が値が高く, ノード数が大きい時は20\%と40\%の時の方が値が高かった. この結果, ノード数によって割合を変えることが良いことがわかった.

\subsection{役割の適切性に対する評価}
次に役割を与えたことの適切性に対する評価を行う. 図\ref{fig:throughput-role}に役割を与えた場合のスループットの推移の様子を示す.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/throughput-role.eps}
  \caption{各ノード数におけるスループットの推移}
  \label{fig:throughput-role}
\end{figure}

\newpage

図\ref{fig:throughput-no-role}に役割を与えない場合のスループットの推移の様子を示す.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/throughput-no-role.eps}
  \caption{役割を与えない場合の各ノード数におけるスループットの推移}
  \label{fig:throughput-no-role}
\end{figure}

\newpage

図\ref{fig:throughput-compare}に2つの場合を比較した様子を示す.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/throughput-compare.eps}
  \caption{役割を与えない場合の各ノード数におけるスループットの推移の平均の比較}
  \label{fig:throughput-compare}
\end{figure}

\newpage

\subsection{ダイジェスト保有率に対する評価}
一定時間経つとダイジェスト未取得ノードはダイジェスト取得ノードになる

ダイジェスト保有率の式

ダイジェスト保有率の結果の表

\subsection{トポロジ設計に対する評価の考察}
役割を与えることの有用性確認できた、接続数を分散できたため

ダイジェスト保有率は高かった、コメント数の多いノードにダイジェストをもたせたため

