本研究では,  配信に途中参加したユーザがダイジェスト視聴可能なP2Pライブストリーミングシステムを提案してきた. そのために2つの段階を考え, 1つ目の段階では, P2Pネットワーク内で特別なサーバに頼らない, 汎用的なダイジェスト生成方式を提案した. 2つ目の段階では, 1つ目の段階において生成されたダイジェストをP2Pネットワーク内で保持し, それを拡散させるためのトポロジ設計を提案した.

この章では, まず1段階目のダイジェスト生成方式に対する評価を行い, その次に2段階目のトポロジ設計に対する評価を行う.

ダイジェスト生成方式では, まず3つの提案方式それぞれに設定されている閾値の適切な値を決めるための評価を行う. その次に実際の動画コンテンツを対象に提案システムを適用し, ダイジェスト生成に最も適切な方式を決定する. トポロジ設計では, まず各役割ノードの適切な割合を決めるための評価を行う. その次にその役割ノードが適切な役目を果たしているかの評価を行う. さらに生成されたダイジェストが適切にP2Pネットワーク内で保持され, 視聴出来たかの評価を行う. なお, 評価はシミュレーションで行う.

表\ref{tbl:env}に評価実験を行った環境を示す.

\begin{table}[h]
  \caption{実行環境}
  \label{tbl:env}
  \centering
      {\small
        \begin{tabular}{|l|l|l|} \hline
          環境名 & 規格 & バージョン \\ \hline \hline
          OS & Ubuntu & 12.04 64-bit  \\ \hline
          CPU & Intel Core i7 2.10~GHz & \\ \hline
          メモリ & 8~GB & \\ \hline
          シミュレータ & NS2 & 2.35 \\ \hline
          言語 & OTcl & 1.14 \\ \cline{2-3}
           & TK & 8.5.10 \\ \hline
          可視化ツール & nam & 1.15 \\ \hline
        \end{tabular}
      }
\end{table}

\section{ダイジェスト生成方式に対する評価}\label{sec:ev-digest}
\subsection{評価の準備}
ダイジェスト生成方式に対する評価を行う際の準備について述べる. 評価の1つ目は, 3つの提案方式の適切な閾値を決めることである. 2つ目は3つの提案方式のうち最も適切な方式を決定することである.

2つの評価に共通するものとして, 対象となる映像がある. まず配信時間の長さの異なる3つ映像に対して, 時間の10分の1となる1つ2分間の正解シーンを用意した. つまり, 例えば100分の映像を扱う際には5個の正解シーンが存在するということである.

\subsection{適切な閾値の決定}
3つの提案方式の適切な閾値を決定するための評価方法について述べる. まず, 提案システムがダイジェストであると選出したシーンの数が, 元々用意しておいた正解シーンよりも半分以上であるものを集計する. なお, 正解シーンの前後2分間をダイジェストと判断した場合を選出出来たと判断して集計する. 集計した後, 最も多く正解シーンを選出した閾値を適切な値とする. 例えば100分の映像ならば, 正解シーンが5つ存在する. そのうち提案システムが半分以上選出出来たらならばプラス1カウントする. これを3つの映像それぞれについて行い, 最も多く選出出来た（映像は3種類なので最大で3）閾値を適切な値とする.

\subsubsection{閾値に基づくダイジェスト生成方式の閾値}
「閾値に基づくダイジェスト生成方式」では式\ref{fig:sikiiti}において閾値は, 増加率（$Th_{inc}$）, 減少率（$Th_{dec}$）で, パラメータは一定期間（$T$）であった. 図\ref{fig:digest1-1}は閾値に基づくダイジェスト生成方式の抽出例である. 時刻に付いている赤い丸が正解シーンであり, 縦に緑の線がシステムがダイジェストであると判断して選出した箇所である. 図を見るとAと記した1箇所で正解していることがわかる.

表\ref{tbl:digest1-1}に増加率0.05の時の正解シーン選出の結果を, 表\ref{tbl:digest1-2}に増加率0.10の時の正解シーン選出の結果を示す. 実験の結果, 増加率が0.1, 減少率が0.03, 一定期間が3である時が一番正解数が多く, 適切な値であることがわかった.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/digest1-1.eps}
  \caption{閾値に基づくダイジェスト生成方式の抽出例}
  \label{fig:digest1-1}
\end{figure}

\begin{table}[h]
  \caption{増加率0.05の時の正解シーン選出の結果}
  \label{tbl:digest1-1}
  \centering
      {\small
        \begin{tabular}{|l|l||l|l|l|} \hline
           \multicolumn{5}{|c|}{増加率（$Th_{inc}$）0.05} \\ \hline
           & & \multicolumn{3}{c|}{減少率（$Th_{dec}$）} \\ \hline
           & & 0.03 & 0.05 & 0.10 \\ \hline \hline \cline{2-5}
           & 1 & 0 & 1 & 1 \\ \cline{2-5}
           & 2 & 0 & 0 & 2 \\ \cline{2-5}
           & 3 & 2 & 2 & 1 \\ \cline{2-5}
           一定期間（$T$）& 4 & 1 & 1 & 1 \\ \cline{2-5}
           & 5 & 2 & 2 & 1 \\ \cline{2-5}
           & 6 & 2 & 2 & 1 \\ \cline{2-5}
           & 7 & 1 & 1 & 1 \\ \cline{2-5}
           \hline
        \end{tabular}
      }
\end{table}

\newpage

\begin{table}[h]
  \caption{増加率0.10の時の正解シーン選出の結果}
  \label{tbl:digest1-2}
  \centering
      {\small
        \begin{tabular}{|l|l||l|l|l|} \hline
           \multicolumn{5}{|c|}{増加率（$Th_{inc}$）0.10} \\ \hline
           & & \multicolumn{3}{c|}{減少率（$Th_{dec}$）} \\ \hline
           & & 0.03 & 0.05 & 0.10 \\ \hline \hline \cline{2-5}
           & 1 & 1 & 1 & 0 \\ \cline{2-5}
           & 2 & 2 & 2 & 1 \\ \cline{2-5}
           & 3 & 3 & 2 & 1 \\ \cline{2-5}
           一定期間（$T$）& 4 & 2 & 2 & 1 \\ \cline{2-5}
           & 5 & 2 & 2 & 1 \\ \cline{2-5}
           & 6 & 2 & 2 & 1 \\ \cline{2-5}
           & 7 & 1 & 1 & 1 \\ \cline{2-5}
           \hline
        \end{tabular}
      }
\end{table}

\newpage

\subsubsection{前後比較に基づくダイジェスト生成方式の閾値}
「前後比較に基づくダイジェスト生成方式」では式\ref{fig:zengo}において閾値は, 増加率（$Th_{inc}$）, 減少率（$Th_{dec}$）で, パラメータは一定期間（$T$）であった. 図\ref{fig:digest2-1}は前後比較に基づくダイジェスト生成方式の抽出例である. 時刻に付いている赤い丸が正解シーンであり, 縦に緑の線がシステムがダイジェストであると判断して選出した箇所である. 図を見るとAと記した1箇所で正解していることがわかる.

表\ref{tbl:digest2-1}に増加率0.05の時の正解シーン選出の結果を, 表\ref{tbl:digest2-2}に増加率0.10の時の正解シーン選出の結果を示す. 実験の結果, 増加率が0.1, 減少率が0.03, 一定期間が4である時が一番正解数が多く, 適切な値であることがわかった.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/digest2-1.eps}
  \caption{前後比較に基づくダイジェスト生成方式の抽出例}
  \label{fig:digest2-1}
\end{figure}

\begin{table}[h]
  \caption{増加率0.05の時の正解シーン選出の結果}
  \label{tbl:digest2-1}
  \centering
      {\small
        \begin{tabular}{|l|l||l|l|l|} \hline
          \multicolumn{5}{|c|}{増加率（$Th_{inc}$）0.05} \\ \hline
          & & \multicolumn{3}{c|}{減少率（$Th_{dec}$）} \\ \hline
          & & 0.03 & 0.05 & 0.10 \\ \hline \hline \cline{2-5}
          & 1 & 0 & 0 & 0 \\ \cline{2-5}
          & 2 & 1 & 1 & 1 \\ \cline{2-5}
          & 3 & 0 & 1 & 0 \\ \cline{2-5}
          一定期間（$T$）& 4 & 0 & 0 & 1 \\ \cline{2-5}
          & 5 & 0 & 0 & 0 \\ \cline{2-5}
          & 6 & 0 & 0 & 0 \\ \cline{2-5}
          & 7 & 0 & 0 & 1 \\ \cline{2-5}
          \hline
        \end{tabular}
      }
\end{table}

\begin{table}[h]
  \caption{増加率0.10の時の正解シーン選出の結果}
  \label{tbl:digest2-2}
  \centering
      {\small
        \begin{tabular}{|l|l||l|l|l|} \hline
          \multicolumn{5}{|c|}{増加率（$Th_{inc}$）0.10} \\ \hline
          & & \multicolumn{3}{c|}{減少率（$Th_{dec}$）} \\ \hline
          & & 0.03 & 0.05 & 0.10 \\ \hline \hline \cline{2-5}
          & 1 & 0 & 0 & 0 \\ \cline{2-5}
          & 2 & 1 & 1 & 0 \\ \cline{2-5}
          & 3 & 1 & 1 & 0 \\ \cline{2-5}
          一定期間（$T$）& 4 & 2 & 1 & 0 \\ \cline{2-5}
          & 5 & 0 & 1 & 1 \\ \cline{2-5}
          & 6 & 0 & 0 & 0 \\ \cline{2-5}
          & 7 & 0 & 0 & 1 \\ \cline{2-5}
          \hline
        \end{tabular}
      }
\end{table}

\newpage

\subsubsection{最小二乗法に基づくダイジェスト生成方式}
「最小二乗法に基づくダイジェスト生成方式」では式\ref{fig:jijo}においてパラメータは, 角度（度）, データ数（個）であった. 図\ref{fig:digest3-1}は最小二乗法に基づくダイジェスト生成方式の抽出例である. 時刻に付いている赤い丸が正解シーンであり, 縦に緑の線がシステムがダイジェストであると判断して選出した箇所である. 図を見るとA, B, C, D, Eと記した5箇所で正解していることがわかる.

表\ref{tbl:digest3-1}に正解シーン選出の結果を示す. 実験の結果, 角度（度）55, データ数（個）3である時が一番正解数が多く, 適切な値であることがわかった.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/digest3-1.eps}
  \caption{最小二乗法に基づくダイジェスト生成方式の抽出例}
  \label{fig:digest3-1}
\end{figure}

\begin{table}[h]
  \caption{正解シーン選出の結果}
  \label{tbl:digest3-1}
  \centering
      {\small
        \begin{tabular}{|l|l||l|l|l|l|l|l|l|l|l|l|l|l|} \hline
          & & \multicolumn{12}{|c|}{角度（度）} \\ \hline
          & & 25 & 30 & 35 & 40 & 45 & 50 & 55 & 60 & 65 & 70 & 75 & 80 \\ \hline \hline
          & 2 & 0 & 0 & 0 & 2 & 3 & 3 & 2 & 1 & 1 & 0 & 0 & 0 \\ \cline{2-14}
          データ数（個） & 1 & 1 & 1 & 1 & 1 & 1 & 3 & 3 & 2 & 2 & 2 & 2 & 2 \\ \cline{2-14}
          & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 2 & 2 & 2 & 2 & 2 & 2 \\ \cline{2-14}
          & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 1 & 1 & 1 & 1 & 1 & 1 \\ \cline{2-14}
          \hline
        \end{tabular}
      }
\end{table}

\subsection{提案方式の評価}\label{subsec: eval-digest}
今までの実験により, それぞれの提案方式の適切な閾値がわかった. 次に, その適切な閾値を適用したそれぞれの提案方式を比較し, P2Pライブストリーミングにおいてダイジェストを生成する際に最も適当なダイジェスト生成方式を決定する.

3つの動画に対して, それぞれの提案方式の適合率を計算することによって評価する. 適合率は式\ref{siki:tekigo}に従う. これは, 提案方式がダイジェストとして選出したもののうち, 元々用意しておいた正解シーンが含まれている確率を意味する. 適合率の値が高いほど, より適切なダイジェスト生成方式であると言える. 表\ref{tbl:tekigo}に実験の結果を示す. 実験の結果, 最小二乗法に基づくダイジェスト生成方式の適合率が最も高く, 平均で66\%を超えるという結果になった.

\begin{eqnarray}
  適合率 = \frac{正解シーン数}{方式による抽出シーン数}
  \label{siki:tekigo}
\end{eqnarray}

\begin{table}[h]
  \caption{適合率の結果}
  \label{tbl:tekigo}
  \centering
      {\small
        \begin{tabular}{|l|l|l|l|} \hline
          & \multicolumn{3}{|c|}{適合率} \\ \hline
          生成方式 & 閾値に基づく方式 & 前後比較に基づく方式 & 最小二乗法に基づく方式 \\ \hline
          動画1 & 12.5\% & 50.0\% & 62.5\% \\ \hline
          動画2 & 37.5\% & 50.0\% & 75.0\% \\ \hline
          動画3 & 50.0\% & 50.0\% & 62.5\% \\ \hline
        \end{tabular}
      }
\end{table}

\subsection{ダイジェスト生成方式に対する評価の考察}
ダイジェスト生成方式の実験では, まずそれぞれの提案方式の適切な閾値を決定した. 次にその閾値を適用した提案方式の適合率を計算することによって最も適切なダイジェスト生成方式を決定した.

適切な閾値の決定では, 「閾値に基づくダイジェスト生成方式」, 「前後比較に基づくダイジェスト生成方式」, 「最小二乗法に基づくダイジェスト生成方式」のそれぞれで閾値を決定した. それぞれについて考察していく. 次に適合率の結果についての考察を行う.

\subsubsection{閾値に基づくダイジェスト生成方式に対する考察}
実験的に求めた望ましい閾値は増加率0.1, 減少率0.03, 一定時間3（ms）という結果であった. 増加率は減少率よりも高い値であった. これは, 瞬間的に多くのユーザがコメントをして, その瞬間に対して反応したことを意味している. 瞬間的に多くの反応があったということは, とても注目度が高いことを意味しており, ダイジェストにすべき瞬間であったことがわかる. まだ, 一定時間は3という結果であり, 長くもなく短くもない値であった. これは, 短すぎると雑音となる部分まで余計に反応してしまうためであり, 逆に長すぎると瞬間的な変化に反応出来ないからであると考えられる.

\subsubsection{前後比較に基づくダイジェスト生成方式に対する考察}
実験的に求めた望ましい閾値は増加率0.1, 減少率0.03, 一定時間4（ms）という結果であった. この閾値は「閾値に基づくダイジェスト生成方式」の結果とほぼ同じであり, 基本的には同様の考え方が出来る. しかし, こちらの方式では増加率が0.05の場合だとほとんど正解シーンを選出出来なかったことがわかる. これは「前後比較に基づくダイジェスト生成方式」の方では特に増加率の値に敏感であり, 細かい値を設定することが望ましいことがわかった.

\subsubsection{最小二乗法に基づくダイジェスト生成方式に対する考察}
実験的に求めた望ましい閾値は角度55（度）, データ数3（個）という結果であった. 全体的に角度は急なほど正解シーンを多く選出していることがわかる. これは, より瞬間的な状態を検出していることがわかる. データ数は少ない方が多く正解シーンを選出していることがわかる. これは, データ数が多いほどグラフをなだらかにしてしまい, 瞬間的な状態を検出出来なかったからではないかと考えられる.

\subsubsection{適合率の結果に対する考察}
適合率は「最小二乗法に基づくダイジェスト生成方式」が最も適切であることがわかった. これは, その他の方式では雑音となる突発的な瞬間を誤検知してしまったのに対し, こちらの方式では最小二乗法を適用していることで, より自然な盛り上がり部分をダイジェストとして捉え, 検出出来ているからではないかと考えられる.

\subsubsection{ダイジェスト生成方式の要求条件に対する考察}
ダイジェスト生成方式の要求条件に対する考察を行う. 各要求条件を示し, それについての考察を行う.

\begin{itemize}
\item 特定の種類のコンテンツに依存しないダイジェスト生成方式であること \\
本研究では, 単位時間当たりにコメントしたユーザ数を利用したダイジェスト生成方式を提案し, これは特定のコンテンツに依存しない, 汎用的なものである.
\item P2Pライブストリーミングに特化したダイジェスト生成方式であること \\
上記と同様, 参加ユーザが配信内容に対して自由にコメント投稿が出来るシステムにおいて, 単位時間当たりにコメントしたユーザ数を利用したことは, P2Pのライブストリーミングに特化したものである.
\item 生成されたダイジェストの映像によってコンテンツの内容の全体把握が出来ること \\
\ref{subsec: eval-digest}節の結果, 平均で66\%の適合率を記録した. 提案したダイジェスト生成方式によって, コンテンツの内容の全体を把握することが出来る.
\end{itemize}


\section{トポロジ設計に対する評価}
トポロジ設計に対する評価を行う. 評価はシミュレーションで行った. シミュレーションにはNS-2を用いた. 提案システムでは各ノードに役割を与えたトポロジを設計した. その各役割の適切な割合についての評価を行う. また, 役割ノードが適切に機能しているかの評価を行う. そして, 配信者ノードから各ノードへ送られるストリームの遅延に対する評価を行う. さらに, P2Pネットワーク内に十分なダイジェストを保有できているかを評価する.

\subsection{前提条件}
シミュレーションを行う上でいくつかの前提となる条件について述べる. 前提となる項目に「帯域幅分布」, 「コメント数分布」, 「ノード数とクラスタ」がある. それぞれについての前提条件を決定する.

全ノードには固有の帯域幅を割り当てる.
「帯域幅分布」は, 他のP2Pライブストリーミング研究\cite{band-dist}で使用されている値を参考にする. この研究ではインターネットユーザの帯域幅分布を解析した2つの研究\cite{band-dist-1}\cite{band-dist-2}を参考にしている. 帯域幅は全10種類あり, 平均は540kbpsである. 表\ref{tbl:band-dist}のように決定する.

\begin{table}[h]
  \caption{帯域幅分布}
  \label{tbl:band-dist}
  \centering
      {\small
        \begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|} \hline
          \shortstack{帯域幅 \\ (kbps)} & 256 & 320 & 384 & 448 & 512 & 640 & 768 & 1024 & 1500 & 3000 \\ \hline
          \shortstack{割合 \\ (\%)} & 10.0 & 14.3 & 8.6 & 12.5 & 2.2 & 1.4 & 6.6 & 28.1 & 1.4 & 14.9 \\ \hline
        \end{tabular}
      }
\end{table}

また, 全ノードには固有のコメント数を割り当てる. サンプルとして1つの動画に対して分析を行った結果を利用する\cite{comment}. 1つ24分で2013年3月20日時点での動画を参考にしている. 1人当たりの平均コメント数は4で標準偏差は6.8である.

図\ref{fig:comment-res}は, 動画を分析した結果である. 横軸が1人当たりのコメント数, 縦軸がそのコメント数をしている人の割合である.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/comment-res.eps}
  \caption{コメント数分析の結果}
  \label{fig:comment-res}
\end{figure}

\newpage

図\ref{fig:comment-res}を10種類の具体的な数字に表すと表\ref{tbl:comment-dist}が出来上がる. この表を元に, 各ノードに対して固有のコメント数を割り当てる.

\begin{table}[h]
  \caption{コメント数分布}
  \label{tbl:comment-dist}
  \centering
      {\small
        \begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|} \hline
          \shortstack{コメント数} & 2 & 5 & 7 & 10 & 12 & 15 & 17 & 20 & 22 & 25 \\ \hline
          \shortstack{割合 \\ (\%)} & 15 & 16 & 16 & 15 & 13 & 11 & 10 & 2 & 1 & 1 \\ \hline
        \end{tabular}
      }
\end{table}

また, 全ノード数に応じたクラスタの数を予め設定しておく. 設定する値は\cite{cluster-dist}の研究で示されている線形関数を利用する. 図\ref{fig:node-cluster}に参加ノード数に応じたクラスタ数の変化を示す. このグラフを元に表\ref{tbl:cluster-dist}を作成した. こちらの表の通り全ノード数に対するクラスタ数を決定する. 全ノード数は4種類を対象とする.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/node-cluster.eps}
  \caption{コメント数分析の結果}
  \label{fig:node-cluster}
\end{figure}

\begin{table}[h]
  \caption{ノード数とクラスタ数対応表}
  \label{tbl:cluster-dist}
  \centering
      {\small
        \begin{tabular}{|c|c|c|c|c|} \hline
          \shortstack{ノード数} & 200 & 400 & 600 & 800 \\ \hline
          \shortstack{クラスタ数} & 7 & 10 & 14 & 18  \\ \hline
        \end{tabular}
      }
\end{table}


その他の前提条件として, ノード間遅延を全てのノード間で100msに設定している. またパケットロス率は0\%として考慮しないこととする. また, 参加離脱を考慮した実験においては, 10秒に1回参加と離脱を行うこととする. 参加はランダムであり, 最初はダイジェスト未取得のノーマルノードとなる. ダイジェスト未取得のノーマルノードは24秒経つとダイジェスト取得済みのダイジェストノードとなる. また, シミュレーションにおいての参加離脱はノードにパケットが流れたかどうかで判断する.

ノード数が200の時の、役割を与えた場合のトポロジ図を図\ref{fig:topology-role}に示す. 図ではゲートノードが全体の10\%, セミゲートノードが全体の10\%, ダイジェストノードが全体の20\%となるように構成されている. 具体的な構成を表\ref{tbl:topology-ex}に示す.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/topology-role.eps}
  \caption{役割を与えた場合のトポロジ図}
  \label{fig:topology-role}
\end{figure}

\newpage

\begin{table}[h]
  \caption{ノード数が200時の役割を与えた時の役割構成}
  \label{tbl:topology-ex}
  \centering
      {\small
        \begin{tabular}{|c|c|} \hline
        役割 & ノード数 \\ \hline \hline
        配信者ノード & 1 \\ \hline
        ゲートノード & 21 \\ \hline
        セミゲートノード & 21 \\ \hline
        ダイジェストノード & 42 \\ \hline
        ノーマルノード & 112 \\ \hline
        \end{tabular}
      }
\end{table}

ノード数が200の時の, 役割を与えない場合のトポロジ図を図\ref{fig:topology-no-role}に示す. 図では役割が無く, 全てがノーマルノードになっている. 具体的な構成を表\ref{tbl:topology-ex-no-role}に示す.

\newpage

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/topology-no-role.eps}
  \caption{役割を与えない場合のトポロジ図}
  \label{fig:topology-no-role}
\end{figure}

\begin{table}[h]
  \caption{ノード数が200時の役割を与えない時の役割構成}
  \label{tbl:topology-ex-no-role}
  \centering
      {\small
        \begin{tabular}{|c|c|} \hline
        役割 & ノード数 \\ \hline \hline
        配信者ノード & 1 \\ \hline
        ノーマルノード & 199 \\ \hline
        \end{tabular}
      }
\end{table}

以上のトポロジ構成にしたがって, 役割を与えた場合と与えない場合での比較を行う.

\newpage

\subsection{適切な役割の割合の決定}
提案するトポロジに存在するノードの役割のうち「ゲートノード」, 「セミゲートノード」, 「ダイジェストノード」の役割の適切な割合を決定する. まず最初に「ダイジェストノード」の割合を, 次に「ゲートノード」と「セミゲートノード」の割合を決定する.

\subsubsection{ダイジェストノードの割合}
ダイジェストノードの割合をそれぞれ, 全ノードの10\%, 20\%, 30\%で割合を変え, スループットの値を比較した. スループットはネットワーク全体で単位時間当たりに受信したパケット数と定義する.

図\ref{fig:digest-rate}に結果を示す.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/digest-rate.eps}
  \caption{ダイジェストノードの割合を変化させた時の結果}
  \label{fig:digest-rate}
\end{figure}

実験の結果, 10\%の時の平均スループットが265.71kbps, 20\%の時の平均スループットが573.12kbps, 30\%の時の平均スループットが414.63\%であった. 20\%の時が最もスループットの値が大きく, 適切な値であることがわかった.

\subsubsection{ゲートノードとセミゲートノードの割合}
次にゲートノードとセミゲートノードの割合を決定する. ゲートノードとセミゲートノードは常に1対1の関係となるため, 一緒に決定する. 全ノードのそれぞれ10\%と10\%, 20\%と20\%で割合を変え, スループットの値を比較した. 図\ref{fig:gate-semi-rate}に結果を示す.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/gate-semi-rate.eps}
  \caption{ゲートノードとセミゲートノードの割合を変化させた時の結果}
  \label{fig:gate-semi-rate}
\end{figure}

実験の結果, 10\%と10\%の時の平均スループットが446.33kbps, 20\%と20\%の時の平均スループットが413.48kbpsであった. どちらもそれほど変わらないが, 10\%と10\%の方がスループットの値が大きかった. しかし, グラフを見るとノード数が小さい時は10\%と10\%の時の方が値が高く, ノード数が大きい時は20\%と20\%の時の方が値が高かった.

\subsection{役割の適切性に対する評価}\label{subsec:eval-role}
次に役割を与えたことの適切性に対する評価を行う. 図\ref{fig:throughput-role}に役割を与えた場合のネットワーク全体のスループットの推移の様子を示す. udp200はノード数が200の時を意味する. 図を見ると, ノード数が200の時が一番低い値を取っているが, それ以降ノード数が大きくなってもスループットの値が低下していないことがわかる.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/throughput-role.eps}
  \caption{各ノード数におけるスループットの推移}
  \label{fig:throughput-role}
\end{figure}

\newpage

図\ref{fig:throughput-no-role}に役割を与えない場合のスループットの推移の様子を示す. udp200-no-roleはノード数が200の時を意味する. 図を見ると, ノード数が200の時が一番高い値を取っているが, それ以降ノード数が大きくなるに連れてスループットの値が低下していることが分かる.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/throughput-no-role.eps}
  \caption{役割を与えない場合の各ノード数におけるスループットの推移}
  \label{fig:throughput-no-role}
\end{figure}

\newpage

図\ref{fig:throughput-compare}に役割を与えた場合と与えない場合の各ノード数におけるスループットの推移の平均の比較を示す. averageが役割を与えた場合であり, average-no-roleが役割を与えない場合である. 図を見ると, 役割が無い場合はノード数が大きくなるとスループットの値が低下しているのに対し, 役割がある場合はノード数が大きくなってもスループットの値が低下していないことがわかる. また, 役割を与えない場合の平均のスループットの値は161.48kbpsであり, 役割を与えた場合の平均のスループットの値は406.73kbpsであった.

この結果, 役割を与えたことによってP2Pネットワーク全体で質の高い映像が見れていることがわかり, 役割を与えたことの有用性を確認することが出来た.

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/throughput-compare.eps}
  \caption{役割を与えない場合の各ノード数におけるスループットの推移の平均の比較}
  \label{fig:throughput-compare}
\end{figure}

\newpage

\subsection{配信者ノードから各ノードへの遅延に対する評価}\label{subsec:eval-delay}
配信者ノードから各ノードへの遅延に対する評価を行う. 配信者ノードから各ノードへのホップ数を求めることで, ネットワーク全体における配信者ノードからの遅延を評価する. 表\ref{tbl:hop-count}は各ノード数におけるネットワーク全体の平均ホップ数の結果である. 表において平均値だけをグラフにしたものを図\ref{fig:average-hop-count}に示す.

\begin{table}[h]
  \caption{各ノード数におけるネットワーク全体の平均ホップ数}
  \label{tbl:hop-count}
  \centering
      {\small
        \begin{tabular}{|c|c|c|} \hline
        ノード数 & 合計ホップ数 & 平均ホップ数 \\ \hline \hline
        200 & 645 & 3.23 \\ \hline
        400 & 1288 & 3.22 \\ \hline
        600 & 1864 & 3.11 \\ \hline
        800 & 2514 & 3.14 \\ \hline
        \end{tabular}
      }
\end{table}

\begin{figure}[h]
  \centering
  \includegraphics[width=1\hsize]{fig/average-hop-count.eps}
  \caption{各ノード数におけるネットワーク全体の平均ホップ数グラフ}
  \label{fig:average-hop-count}
\end{figure}

実験の結果, ノード数を変化させた時の平均のホップ数を計算すると3.18であり, ノード数が増えてもネットワーク全体の平均ホップ数の値は変化しないことが分かった. これにより, ノード数が増えてもネットワーク全体で遅延が増えることなく, 配信を行うことが出来ることがわかった.

\subsection{ダイジェスト保有率に対する評価}\label{subsec:eval-digest-have}
ダイジェスト保有率に対する評価を行う. ダイジェスト保有率に対する評価では, ノードが参加と離脱を行う場合を想定してシミュレーションを行う. このシミュレーションを行うにあたって与えた条件を次に示す. まず, これまではノード数に対するクラスタ数を表\ref{tbl:cluster-dist}のように示してきたが, このシミュレーションでは1クラスタのみを対象として行う. 具体的にはノード数28に対してクラスタ数1で行う. また, NS-2ではノードを新たに追加したり, 既存のノードを離脱させることが厳密には出来ない. そこで, このシミュレーションではノードに対してパケットを流すことでネットワークに参加していることを表し, パケットを流さないことでネットワークから離脱していることを表す. 表\ref{tbl:digest-have}にダイジェスト保有率に対する評価の構成を示す.

\begin{table}[h]
  \caption{ダイジェスト保有率に対する評価の構成}
  \label{tbl:digest-have}
  \centering
      {\small
        \begin{tabular}{|c||c|} \hline
        ノード数 & 28 \\ \hline
        クラスタ数 & 1 \\ \hline
        & 配信者ノード: 1 \\ \cline{2-2}
        & ゲートノード: 3 \\ \cline{2-2}
        役割とノード数 & セミゲートノード: 3 \\ \cline{2-2}
        & ダイジェストノード: 6 \\ \cline{2-2}
        & ノーマルノード: 16 \\ \cline{2-2}
        \hline
        \end{tabular}
      }
\end{table}

1つのダイジェストは1つのダイジェストノードが保有しており, ダイジェストノードが離脱することでそのノードが保有していたダイジェストが失われることになる. ダイジェスト保有率は以下の式\ref{siki:digest-have}に従う.

\begin{eqnarray}
        ダイジェスト保有率 = \nonumber \\
        \frac{ダイジェストノード数 - 離脱したダイジェストノード数}{ダイジェストノード数}
        \label{siki:digest-have}
\end{eqnarray}

また, 各ノードの離脱率はコメント数に比例し, 表\ref{tbl:comment-dist}に従う.

シミュレーションを10回行った結果を表\ref{tbl:digest-have-res}に示す.

\begin{table}[h]
  \caption{ダイジェスト保有率に対する評価の結果}
  \label{tbl:digest-have-res}
  \centering
      {\small
        \begin{tabular}{|c||c|c|c|c|c|c|c|c|c|c|} \hline
        回数 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 \\ \hline
        ダイジェスト保有率（\%） & 66.7 & 83.3 & 83.3 & 66.7 & 66.7 & 83.3 & 88.3 & 88.3 & 66.7 & 83.3 \\ \hline
        \end{tabular}
      }
\end{table}

実験の結果, 全ての回数で66.7\%以上の保有率があり, 平均で76\%の保有率を達成した. 配信内容全体の76\%を把握出来るということであり, 配信内容の概要を知るのに十分であると考えられる.

\subsection{トポロジ設計に対する評価の考察}
トポロジ設計に対する実験では, まず「ダイジェストノード」, 「ゲートノード」, 「セミゲートノード」の3つの役割のそれぞれで適切な割合を決定した. 次に役割を与えたことの適切性についての評価を行った. そして配信者ノードからの遅延に対する評価を行った. さらにダイジェスト保有率に対する評価を行った. それぞれについての考察を行う.

\subsubsection{ダイジェストノードの割合の決定に対する考察}
ダイジェストノードの割合は20\%が良いという結果だった. 図\ref{fig:digest-rate}を見ると, 20\%の時はノード数が600の時にとても高い値を記録しているが, それ以外は30\%の時とほぼ同じ値を記録していることがわかる. 20\%の時は突発的に大きな値を取っていた可能性が高く, 実際は状況に応じて20\%から30\%の割合にするのが良いと考えた.

\subsubsection{ゲートノードとセミゲートノードの割合の決定に対する考察}
ゲートノードとセミゲートノードの割合はノード数によって割合を変えることが良いという結果であった. ノード数が小さい時は10\%と10\%に, ノード数が大きい時は20\%と20\%が良いということだった. ノード数が小さい時にそれぞれの割合が小さい方が良い理由として, 1ノード当たりの接続数が少ないことが原因であると考えられる. ノード数が小さいと接続数が少ないので, 1ノード当たりの負担が小さく, 小さい割合でも問題ないのではないかと考えられる. ノード数が大きい時にそれぞれの割合が大きい方が良い理由も同様である. 1ノード当たりの負担が大きくなり, 割合を増やす必要があるのではないかと考えられる.

\subsubsection{役割の割合決定全体に対する考察}
「ダイジェストノード」と, 「ゲートノード」と「セミゲートノード」の割合のどちらも状況によって変える方が良いという結果だった. とくに後者では具体的に接続数が問題になっていた. 本システムでは役割を割合で決定しているが, 接続数に関しては考慮していなかった. ノード数によってクラスタの数を変えているので, 接続数が爆発的に多くなることはないが, 役割の数を決定する方法として割合よりも接続数を考慮すべきであったと考えられる.

\subsubsection{役割を与えた場合に対する考察}
役割を与えた場合は, ノード数が200の時以外は高い値を取っているという結果だった. ノード数が200の時に低くなっている理由として, 1ノード当たりの接続数が少なすぎるからであると考えられる. 十分な接続数を確保できないため, 各ノードが取得可能なパケットが少なく, 全体としてスループットの値が低くなっているのではないかと考えられる.

\subsubsection{役割を与えない場合に対する考察}
役割を与えない場合は, ノード数が200の時にスループットが一番高い値を取っているという結果だった. ノード数が多くなるに連れてスループットの値が低くなっていく理由として, 接続数が爆発的に多くなるからではないかと考えられる. 役割を与えない場合は全てのノードがノーマルノードであるため, 接続数が分散されずに多くなってしまう. そのためスループットの値が小さくなっていると考えられる.

\subsubsection{役割の適切性全体に対する考察}
役割を与えたほうが役割を与えない場合に比べ全体的なスループットの値が大きく, 役割を与えることは有用であったという結果だった. 値に差が出てしまった要因としてはやはり接続数の問題があった. 特に役割を与えない場合では接続数の多さがスループット低下の要因であることを顕著に表していた. 結果的に役割を与えることは有用であることはわかったが, さらに性能をあげるためには接続数を考慮すべきであることがわかった.

\subsubsection{配信者ノードから各ノードへの遅延に対する考察}
ノード数が増えてもネットワーク全体で平均ホップ数が増えること無く, 遅延が増えることがないという結果だった. 提案するトポロジ設計では, ホップ数が小さくなるような設計であった. 具体的には, ノード数が増えるごとにクラスタ数を増やし, また各ノードのホップ数が小さくなるように接続する相手を明確化した. その結果, 狙い通りホップ数を小さくすることが出来たと考えられる.

\subsubsection{ダイジェスト保有率に対する考察}
ダイジェスト保有率は平均で76\%を記録し, 概要を知るのに十分という結果だった. ダイジェスト保有率が高かった理由として, ダイジェストノードをコメント数の多いノードから選出したことがあげられる. コメント数の多いノードは離脱可能性が低く, そのようなノードにダイジェストを持たせることで, ダイジェストをP2Pネットワーク内に保持出来ると考えられる. しかし, 本研究では1ダイジェストノードに1ダイジェストを持たせており, ダイジェストノードが抜けると, そのノードが保持していたダイジェストが失われてしまう. この問題を解決するために, 1つのダイジェストは複数のダイジェストで保持することが良いと考えられる. このようにすることで, 接続数は多くなるものの, ダイジェスト保有率はより高く維持することが出来るはずである.

\subsubsection{トポロジ設計の要求条件に対する考察}
トポロジ設計の要求条件に対する考察を行う. 各要求条件を示し, それについての考察を行う.

\begin{itemize}
\item ライブストリーミングの映像を見られるだけの性能があること \\
\ref{subsec:eval-role}節の結果, 役割を与えた場合では, ノード数を変化させた時の平均のスループットの値が406.73kbpsであった. これはライブストリーミングの映像を十分に見ることが出来る性能である.
\item 少ない遅延でパケットが届くこと \\
\ref{subsec:eval-delay}節の結果, 平均のホップ数は3.18であった. ノード数が増えてもネットワーク全体で遅延を抑えることでき, 少ない遅延でパケットが各ノードに届くと考えられる.
\item ダイジェストをP2Pネットワーク内に確保できること \\
\ref{subsec:eval-digest-have}節の結果, ダイジェスト保有率は平均で76\%を達成した これは配信内容の概要を知るのに十分なダイジェストをP2Pネットワーク内に確保出来ると考えられる.
\end{itemize}

