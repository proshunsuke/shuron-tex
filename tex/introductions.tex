ネットワーク技術の発達に伴い, ネットワークを用いた動画配信サービスが人気である. 特にリアルタイム動画配信サービスが人気であり, 日本ではニコニコ生放送\cite{nico}やTwitCasting\cite{twi}, アメリカではUstream\cite{ust}, 韓国ではAfeecaTV\cite{afr}と, 近年世界中で急速に普及している.  このようなサービスの形態としては, サーバから配信された映像ををクライアントが視聴する, サーバ-クライアント方式が一般的である. しかし, 配信サーバのコスト削減や配信者の負荷を軽減するため, サーバを介さず直接クライアント同士で配信を行うP2P（peer to peer）を利用したライブストリーミング配信が期待されている.

P2Pライブストリーミングは主にアプリケーションレベルマルチキャスト（ALM: Application Level Multicast）によって行われる. ALMはアプリケーションによって実現されるため開発が容易で多くの研究がなされている.

%% そこで本研究では, 配信に途中参加したユーザがダイジェスト視聴可能なP2Pライブストリーミングシステムにおいて, P2Pネットワーク内でダイジェストを生成し, 保持し, 広めるために各ピアが役割を持ったトポロジを提案する. ダイジェストを作成する専用のサーバは設置せず, ネットワーク内に存在するピアが作成し, それをネットワーク内に広める. システムはダイジェストがP2Pネットワーク内で枯渇しないような設計にする必要がある.

\section{P2Pライブストリーミングのトポロジ}
ALMは主にツリー型とメッシュ型に分類される. ツリー型は遅延が少なく構築が容易であるというメリットがあるが, 耐故障性やノードの離脱に弱いといったデメリットがある. メッシュ型は耐故障性やノードの離脱に強いというメリットがあるが, 複数の経路を用いるため遅延が大きくなるといったデメリットがある. 一方でこれらツリー型やメッシュ型の欠点を補うために複数クラスタ型\cite{dis},\cite{streamline}が提案されている. 複数クラスタ型は複数のクラスタを構築し各サブストリームをそれぞれのクラスタで配信するといった方法である. 複数クラスタ型ではツリー構造のように中継ノードにストリームを渡すため, 配信の負荷が軽減される. またクラスタ内部では各ノードが複数の経路を持つため耐故障性に優れる. 以下に複数クラスタ型の既存研究をあげる.

\newpage

\subsection{階層型クラスタ構造}
Yang Guoらは階層的クラスタHCPS（Hierarchically Clus-tered P2P Video Streaming）\cite{hcps}\ref{fig:hcps}を提案している. HCPSはクラスタ間で帯域のバランスを取ることにより, より品質の高い映像を流すことを可能にしている. また, 隣のピアへのチャンクの受け渡しの際に, アップリンク帯域幅を有効活用出来るようなスケジューリングアルゴリズムを提案している. クラスタ内部は完全結合となっており, 各クラスタのアップロード容量が均一になるように構成されている. クラスタを形成する際にクラスタ内で一番最初に配信内容を受け取るノードをヘッドノードと定義し, そのアップロード容量は大きいものを選出している.

HCPSはクラスタの中身が完全結合のため各ノードへのホップ数や遅延が多くなってしまうという課題がある.

\begin{figure}
  \centering
  \includegraphics[width=1\hsize]{fig/hcps.eps}
  \caption{階層型クラスタHCPSのトポロジ設計}
  \label{fig:hcps}
\end{figure}

\subsection{重畳クラスタ木型動画配信システム}
元橋らは重畳クラスタ木方式の動画配信システム\cite{chojo}\ref{fig:chojo}を提案している. 階層的なクラスタ構造になっており, クラスタ間の配信木の中継ノードであるゲートノードが存在する. さらにゲートノードはクラスタ内で一番最初に配信内容を受け取り, それをクラスタ内に広める役割を担っている. ゲートノード選出方式として, 滞在時間の長さとRTT（Round Trip Time）を考慮した方法を提案している. 離脱耐性向上型, 配信遅延抑制型, ハイブリッド型の実験をしたところ, ハイブリッド型が最も性能が良いという結果が出ている.

重畳クラスタ木方式は全体として木構造のため下位のクラスタほど配信者からのホップ数が大きくなってしまうという課題がある.

\begin{figure}
  \centering
  \includegraphics[width=1\hsize]{fig/chojo.eps}
  \caption{重畳型クラスタ木型動画配信システムのトポロジ設計}
  \label{fig:chojo}
\end{figure}

\newpage

\subsection{ハイブリッドアーキテクチャ構造}
Huey-Ing Liuらは局所性と貢献度を考慮したハイブリッドアーキテクチャであるMeTree\cite{metree}を提案している. MeTreeはISP（Internet Service Provider）ごとにクラスタリングを行いそれぞれのノードをメッシュで接続し, 生成された各クラスタ同士をツリー構造で接続している. ツリー構造とメッシュ構造のハイブリッド構造となっている. 配信内容をより多くのノードに広めるような貢献度の高いピアには質の高い映像を配信し, 逆に貢献度の低いピアには質の低い映像を配信する. 異なる貢献度を持つピアに異なるQoE（Quality of Experience）を与えている. 物理トポロジとオーバーレイを構築するためのピアの貢献度の両方を考慮することにより, 遅延を減少させている.

MeTreeでは貢献度を意識した設計のため貢献度の低いノードは良い映像が見られず, ネットワーク全体のQoEは低下してしまうという課題がある.

\begin{figure}
  \centering
  \includegraphics[width=1\hsize]{fig/metree.eps}
  \caption{Metreeのトポロジ設計}
  \label{fig:metree}
\end{figure}

\newpage

\section{ダイジェスト生成方式}
一方で, 動画配信サービスにおいてダイジェストを見ることは, 動画全体の雰囲気を知るために有用である. リアルタイム動画配信であるライブストリーミングにおいても, ユーザが途中から配信に参加した場合にそれまでの配信の内容を把握出来るという点においてダイジェストを見ることは有用である. しかし, P2Pのライブストリーミングにおいては, サーバ-クライアント方式と比べてダイジェストを保存しておくサーバを用意することが出来ないといった問題があり, 既存のサーバ-クライアント方式のためのダイジェスト生成方式が適応出来ない. 以下にダイジェスト生成方式の既存研究をあげる.

\subsection{動画に対するダイジェスト生成方式}
橋本らはスポーツ映像を対象として, 映像メタデータと利用者の嗜好情報を利用したパーソナルダイジェスト生成方式PDMS（Personal Digest Making Scheme）\cite{pdms}を提案している. PDMSは, 映像メタデータから発生事象の重要度を自動的に検出し, 複数のダイジェストを選択する. 従来の手動によるコンテンツ作成に比べ, 携帯端末向けに低コストで生成することができる. 野球の映像を対象とし, 事前に選んだ正解集合と比較して適合率によってダイジェスト配信システムの重要度算出アルゴリズムの評価を行った.

PDMSでは一度映像を整理してシーン毎に分類し, その上でダイジェストシーンを選出している. そのためライブ映像に対してはPDMSの手法を適応することが出来ない.

\subsection{リアルタイム動画に対するダイジェスト生成方式}
熊野らは野球の実況中継映像を対象として, 自動的にインデックス情報を付与して, ハイライトシーンを検出する, リアルタイムダイジェスト生成システム\cite{yakyu}を提案している. システムでは特に野球のPC（Picher and Catcher）シーンを画像解析により検出し, さらに音声解析により特別なイベントと判断されたキーワードを含む区間をハイライトシーンとして生成している. 実験では予め正解であるシーンを用意し, システムを適応した際の適合率により評価を行った. 結果は最も高い適合率で97.2\%という結果であり, 有用であることを示していた.

熊野らの研究ではライブ映像に対してダイジェストをリアルタイムに生成している点が優れている. しかし, 野球という特定の分野の映像を対象にしていたため, 様々な内容の動画配信に対応させることは難しい.
